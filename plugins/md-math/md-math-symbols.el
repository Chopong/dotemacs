(defvar md-math-prettify-symbols-alist
  '( ;; Lowercase Greek letters.
    ("\\alpha" . ?ğ›¼)
    ("\\beta" . ?ğ›½)
    ("\\gamma" . ?ğ›¾)
    ("\\delta" . ?ğ›¿)
    ("\\epsilon" . ?ğœ–)
    ("\\zeta" . ?ğœ)
    ("\\eta" . ?ğœ‚)
    ("\\theta" . ?ğœƒ)
    ("\\iota" . ?ğœ„)
    ("\\kappa" . ?ğœ…)
    ("\\lambda" . ?ğœ†)
    ("\\mu" . ?ğœ‡)
    ("\\nu" . ?ğœˆ)
    ("\\xi" . ?ğœ‰)
    ;; There is no \omicron because it looks like a latin o.
    ("\\pi" . ?ğœ‹)
    ("\\rho" . ?ğœŒ)
    ("\\sigma" . ?ğœ)
    ("\\tau" . ?ğœ)
    ("\\upsilon" . ?ğœ)
    ("\\phi" . ?ğœ™)
    ("\\chi" . ?ğœ’)
    ("\\psi" . ?ğœ“)
    ("\\omega" . ?ğœ”)
    ;; Uppercase Greek letters.
    ("\\Gamma" . ?Î“)
    ("\\Delta" . ?Î”)
    ("\\Lambda" . ?Î›)
    ("\\Phi" . ?Î¦)
    ("\\Pi" . ?Î )
    ("\\Psi" . ?Î¨)
    ("\\Sigma" . ?Î£)
    ("\\Theta" . ?Î˜)
    ("\\Upsilon" . ?Î¥)
    ("\\Xi" . ?Î)
    ("\\Omega" . ?Î©)

    ;; Other math symbols (taken from leim/quail/latin-ltx.el).
    ("\\Box" . ?â—»)
    ("\\Bumpeq" . ?â‰)
    ("\\Cap" . ?â‹’)
    ("\\Cup" . ?â‹“)
    ("\\Diamond" . ?â—Š)
    ("\\Downarrow" . ?â‡“)
    ("\\H{o}" . ?Å‘)
    ("\\Im" . ?â„‘)
    ("\\Join" . ?â‹ˆ)
    ("\\Leftarrow" . ?â‡)
    ("\\Leftrightarrow" . ?â‡”)
    ("\\Ll" . ?â‹˜)
    ("\\Lleftarrow" . ?â‡š)
    ("\\Longleftarrow" . ?âŸ¸)
    ("\\Longleftrightarrow" . ?âŸº)
    ("\\Longrightarrow" . ?âŸ¹)
    ("\\Lsh" . ?â†°)
    ("\\Re" . ?â„œ)
    ("\\Rightarrow" . ?â‡’)
    ("\\Rrightarrow" . ?â‡›)
    ("\\Rsh" . ?â†±)
    ("\\Subset" . ?â‹)
    ("\\Supset" . ?â‹‘)
    ("\\Uparrow" . ?â‡‘)
    ("\\Updownarrow" . ?â‡•)
    ("\\Vdash" . ?âŠ©)
    ("\\Vert" . ?â€–)
    ("\\Vvdash" . ?âŠª)
    ("\\aleph" . ?â„µ)
    ("\\amalg" . ?â¨¿)
    ("\\angle" . ?âˆ )
    ("\\approx" . ?â‰ˆ)
    ("\\approxeq" . ?â‰Š)
    ("\\ast" . ?âˆ—)
    ("\\asymp" . ?â‰)
    ("\\backcong" . ?â‰Œ)
    ("\\backepsilon" . ?âˆ)
    ("\\backprime" . ?â€µ)
    ("\\backsim" . ?âˆ½)
    ("\\backsimeq" . ?â‹)
    ("\\backslash" . ?\\)
    ("\\barwedge" . ?âŠ¼)
    ("\\because" . ?âˆµ)
    ("\\beth" . ?â„¶)
    ("\\between" . ?â‰¬)
    ("\\bigcap" . ?â‹‚)
    ("\\bigcirc" . ?â—¯)
    ("\\bigcup" . ?â‹ƒ)
    ("\\bigstar" . ?â˜…)
    ("\\bigtriangledown" . ?â–½)
    ("\\bigtriangleup" . ?â–³)
    ("\\bigvee" . ?â‹)
    ("\\bigwedge" . ?â‹€)
    ("\\blacklozenge" . ?â§«)
    ("\\blacksquare" . ?â—¼)
    ("\\blacktriangle" . ?â–´)
    ("\\blacktriangledown" . ?â–¾)
    ("\\blacktriangleleft" . ?â—‚)
    ("\\blacktriangleright" . ?â–¸)
    ("\\bot" . ?âŠ¥)
    ("\\bowtie" . ?â‹ˆ)
    ("\\boxminus" . ?âŠŸ)
    ("\\boxplus" . ?âŠ)
    ("\\boxtimes" . ?âŠ )
    ("\\bullet" . ?âˆ™)
    ("\\bumpeq" . ?â‰)
    ("\\cap" . ?âˆ©)
    ("\\cdots" . ?â‹¯)
    ("\\centerdot" . ?Â·)
    ("\\checkmark" . ?âœ“)
    ("\\chi" . ?ğœ’)
    ("\\cdot" . ?â‹…)
    ("\\cdots" . ?â‹¯)
    ("\\circ" . ?âˆ˜)
    ("\\circeq" . ?â‰—)
    ("\\circlearrowleft" . ?â†º)
    ("\\circlearrowright" . ?â†»)
    ("\\circledR" . ?Â®)
    ("\\circledS" . ?â“ˆ)
    ("\\circledast" . ?âŠ›)
    ("\\circledcirc" . ?âŠš)
    ("\\circleddash" . ?âŠ)
    ("\\clubsuit" . ?â™£)
    ("\\coloneq" . ?â‰”)
    ("\\complement" . ?âˆ)
    ("\\cong" . ?â‰…)
    ("\\coprod" . ?âˆ)
    ("\\cup" . ?âˆª)
    ("\\curlyeqprec" . ?â‹)
    ("\\curlyeqsucc" . ?â‹Ÿ)
    ("\\curlypreceq" . ?â‰¼)
    ("\\curlyvee" . ?â‹)
    ("\\curlywedge" . ?â‹)
    ("\\curvearrowleft" . ?â†¶)
    ("\\curvearrowright" . ?â†·)
    ("\\dag" . ?â€ )
    ("\\dagger" . ?â€ )
    ("\\daleth" . ?â„¸)
    ("\\dashv" . ?âŠ£)
    ("\\ddag" . ?â€¡)
    ("\\ddagger" . ?â€¡)
    ("\\ddots" . ?â‹±)
    ("\\diamond" . ?â‹„)
    ("\\diamondsuit" . ?â™¢)
    ("\\divideontimes" . ?â‹‡)
    ("\\doteq" . ?â‰)
    ("\\doteqdot" . ?â‰‘)
    ("\\dotplus" . ?âˆ”)
    ("\\dotsquare" . ?âŠ¡)
    ("\\downarrow" . ?â†“)
    ("\\downdownarrows" . ?â‡Š)
    ("\\downleftharpoon" . ?â‡ƒ)
    ("\\downrightharpoon" . ?â‡‚)
    ("\\ell" . ?â„“)
    ("\\emptyset" . ?âˆ…)
    ("\\eqcirc" . ?â‰–)
    ("\\eqcolon" . ?â‰•)
    ("\\eqslantgtr" . ?âª–)
    ("\\eqslantless" . ?âª–)
    ("\\equiv" . ?â‰¡)
    ("\\exists" . ?âˆƒ)
    ("\\fallingdotseq" . ?â‰’)
    ("\\flat" . ?â™­)
    ("\\forall" . ?âˆ€)
    ("\\frown" . ?âŒ¢)
    ("\\ge" . ?â‰¥)
    ("\\geq" . ?â‰¥)
    ("\\geqq" . ?â‰§)
    ("\\geqslant" . ?â©¾)
    ("\\gets" . ?â†)
    ("\\gg" . ?â‰«)
    ("\\ggg" . ?â‹™)
    ("\\gimel" . ?â„·)
    ("\\gnapprox" . ?âªŠ)
    ("\\gneq" . ?âªˆ)
    ("\\gneqq" . ?â‰©)
    ("\\gnsim" . ?â‹§)
    ("\\gtrapprox" . ?âª†)
    ("\\gtrdot" . ?â‹—)
    ("\\gtreqless" . ?â‹›)
    ("\\gtreqqless" . ?â‹›)
    ("\\gtrless" . ?â‰·)
    ("\\gtrsim" . ?â‰³)
    ("\\gvertneqq" . ?â‰©)
    ("\\hbar" . ?â„)
    ("\\heartsuit" . ?â™¡)
    ("\\hookleftarrow" . ?â†©)
    ("\\hookrightarrow" . ?â†ª)
    ("\\iff" . ?âŸº)
    ("\\imath" . ?Ä±)
    ("\\in" . ?âˆˆ)
    ("\\infty" . ?âˆ)
    ("\\int" . ?âˆ«)
    ("\\intercal" . ?âŠº)
    ("\\langle" . 10216)          ; 10216 Literal ?âŸ¨ breaks indentation.
    ("\\lbrace" . ?{)
    ("\\lbrack" . ?\[)
    ("\\lceil" . ?âŒˆ)
    ("\\ldots" . ?â€¦)
    ("\\le" . ?â‰¤)
    ("\\leadsto" . ?â‡)
    ("\\leftarrow" . ?â†)
    ("\\leftarrowtail" . ?â†¢)
    ("\\leftharpoondown" . ?â†½)
    ("\\leftharpoonup" . ?â†¼)
    ("\\leftleftarrows" . ?â‡‡)
    ;; ("\\leftparengtr" ?âŒ©), see bug#12948.
    ("\\leftrightarrow" . ?â†”)
    ("\\leftrightarrows" . ?â‡†)
    ("\\leftrightharpoons" . ?â‡‹)
    ("\\leftrightsquigarrow" . ?â†­)
    ("\\leftthreetimes" . ?â‹‹)
    ("\\leq" . ?â‰¤)
    ("\\leqq" . ?â‰¦)
    ("\\leqslant" . ?â©½)
    ("\\lessapprox" . ?âª…)
    ("\\lessdot" . ?â‹–)
    ("\\lesseqgtr" . ?â‹š)
    ("\\lesseqqgtr" . ?âª‹)
    ("\\lessgtr" . ?â‰¶)
    ("\\lesssim" . ?â‰²)
    ("\\lfloor" . ?âŒŠ)
    ("\\lhd" . ?âŠ²)
    ("\\rhd" . ?âŠ³)
    ("\\ll" . ?â‰ª)
    ("\\llcorner" . ?âŒ)
    ("\\lnapprox" . ?âª‰)
    ("\\lneq" . ?âª‡)
    ("\\lneqq" . ?â‰¨)
    ("\\lnsim" . ?â‹¦)
    ("\\longleftarrow" . ?âŸµ)
    ("\\longleftrightarrow" . ?âŸ·)
    ("\\longmapsto" . ?âŸ¼)
    ("\\longrightarrow" . ?âŸ¶)
    ("\\looparrowleft" . ?â†«)
    ("\\looparrowright" . ?â†¬)
    ("\\lozenge" . ?â—Š)
    ("\\lq" . ?â€˜)
    ("\\lrcorner" . ?âŒŸ)
    ("\\ltimes" . ?â‹‰)
    ("\\lvertneqq" . ?â‰¨)
    ("\\maltese" . ?âœ )
    ("\\mapsto" . ?â†¦)
    ("\\measuredangle" . ?âˆ¡)
    ("\\mho" . ?â„§)
    ("\\mid" . ?âˆ£)
    ("\\models" . ?âŠ§)
    ("\\mp" . ?âˆ“)
    ("\\multimap" . ?âŠ¸)
    ("\\nLeftarrow" . ?â‡)
    ("\\nLeftrightarrow" . ?â‡)
    ("\\nRightarrow" . ?â‡)
    ("\\nVDash" . ?âŠ¯)
    ("\\nVdash" . ?âŠ®)
    ("\\nabla" . ?âˆ‡)
    ("\\napprox" . ?â‰‰)
    ("\\natural" . ?â™®)
    ("\\ncong" . ?â‰†)
    ("\\ne" . ?â‰ )
    ("\\nearrow" . ?â†—)
    ("\\neg" . ?Â¬)
    ("\\neq" . ?â‰ )
    ("\\nequiv" . ?â‰¢)
    ;;("\\newline" . ?â€¨)
    ("\\nexists" . ?âˆ„)
    ("\\ngeq" . ?â‰±)
    ("\\ngeqq" . ?î€)
    ("\\ngeqslant" . ?î€)
    ("\\ngtr" . ?â‰¯)
    ("\\ni" . ?âˆ‹)
    ("\\nleftarrow" . ?â†š)
    ("\\nleftrightarrow" . ?â†®)
    ("\\nleq" . ?â‰°)
    ("\\nleqq" . ?î€‘)
    ("\\nleqslant" . ?î€)
    ("\\nless" . ?â‰®)
    ("\\nmid" . ?âˆ¤)
    ;; ("\\not" ?Ì¸)              ;FIXME: conflict with "NOT SIGN" Â¬.
    ("\\notin" . ?âˆ‰)
    ("\\nparallel" . ?âˆ¦)
    ("\\nprec" . ?âŠ€)
    ("\\npreceq" . ?î‹)
    ("\\nrightarrow" . ?â†›)
    ("\\nshortmid" . ?âˆ¤)
    ("\\nshortparallel" . ?âˆ¦)
    ("\\nsim" . ?â‰)
    ("\\nsimeq" . ?â‰„)
    ("\\nsubset" . ?âŠ„)
    ("\\nsubseteq" . ?âŠˆ)
    ("\\nsubseteqq" . ?âŠˆ)
    ("\\nsucc" . ?âŠ)
    ("\\nsucceq" . ?î)
    ("\\nsupset" . ?âŠ…)
    ("\\nsupseteq" . ?âŠ‰)
    ("\\nsupseteqq" . ?î€˜)
    ("\\ntriangleleft" . ?â‹ª)
    ("\\ntrianglelefteq" . ?â‹¬)
    ("\\ntriangleright" . ?â‹«)
    ("\\ntrianglerighteq" . ?â‹­)
    ("\\nvDash" . ?âŠ­)
    ("\\nvdash" . ?âŠ¬)
    ("\\nwarrow" . ?â†–)
    ("\\odot" . ?âŠ™)
    ("\\oint" . ?âˆ®)
    ("\\ominus" . ?âŠ–)
    ("\\oplus" . ?âŠ•)
    ("\\oslash" . ?âŠ˜)
    ("\\otimes" . ?âŠ—)
    ;; ("\\par" . ?â€©)
    ("\\parallel" . ?âˆ¥)
    ("\\partial" . ?âˆ‚)
    ("\\perp" . ?âŠ¥)
    ("\\pitchfork" . ?â‹”)
    ("\\prec" . ?â‰º)
    ("\\precapprox" . ?âª·)
    ("\\preceq" . ?âª¯)
    ("\\precnapprox" . ?â‹¨)
    ("\\precnsim" . ?âª¹)
    ("\\precsim" . ?â‰¾)
    ("\\prime" . ?â€²)
    ("\\prod" . ?âˆ)
    ("\\propto" . ?âˆ)
    ("\\qed" . ?âˆ)
    ("\\qquad" . ?â§¢)
    ("\\quad" . ?â£)
    ("\\rangle" . 10217)            ; Literal ?âŸ© breaks indentation.
    ("\\rbrace" . ?})
    ("\\rbrack" . ?\])
    ("\\rceil" . ?âŒ‰)
    ("\\rfloor" . ?âŒ‹)
    ("\\rightarrow" . ?â†’)
    ("\\rightarrowtail" . ?â†£)
    ("\\rightharpoondown" . ?â‡)
    ("\\rightharpoonup" . ?â‡€)
    ("\\rightleftarrows" . ?â‡„)
    ("\\rightleftharpoons" . ?â‡Œ)
    ;; ("\\rightparengtr" ?â¦”) ;; Was ?âŒª, see bug#12948.
    ("\\rightrightarrows" . ?â‡‰)
    ("\\rightthreetimes" . ?â‹Œ)
    ("\\risingdotseq" . ?â‰“)
    ("\\rtimes" . ?â‹Š)
    ("\\times" . ?Ã—)
    ("\\sbs" . ?ï¹¨)
    ("\\searrow" . ?â†˜)
    ("\\setminus" . ?âˆ–)
    ("\\sharp" . ?â™¯)
    ("\\shortmid" . ?âˆ£)
    ("\\shortparallel" . ?âˆ¥)
    ("\\sim" . ?âˆ¼)
    ("\\simeq" . ?â‰ƒ)
    ("\\smallamalg" . ?âˆ)
    ("\\smallsetminus" . ?âˆ–)
    ("\\smallsmile" . ?âŒ£)
    ("\\smile" . ?âŒ£)
    ("\\spadesuit" . ?â™ )
    ("\\sphericalangle" . ?âˆ¢)
    ("\\sqcap" . ?âŠ“)
    ("\\sqcup" . ?âŠ”)
    ("\\sqsubset" . ?âŠ)
    ("\\sqsubseteq" . ?âŠ‘)
    ("\\sqsupset" . ?âŠ)
    ("\\sqsupseteq" . ?âŠ’)
    ("\\square" . ?â—»)
    ("\\squigarrowright" . ?â‡)
    ("\\star" . ?â‹†)
    ("\\straightphi" . ?Ï†)
    ("\\subset" . ?âŠ‚)
    ("\\subseteq" . ?âŠ†)
    ("\\subseteqq" . ?â«…)
    ("\\subsetneq" . ?âŠŠ)
    ("\\subsetneqq" . ?â«‹)
    ("\\succ" . ?â‰»)
    ("\\succapprox" . ?âª¸)
    ("\\succcurlyeq" . ?â‰½)
    ("\\succeq" . ?âª°)
    ("\\succnapprox" . ?â‹©)
    ("\\succnsim" . ?â‹©)
    ("\\succsim" . ?â‰¿)
    ("\\sum" . ?âˆ‘)
    ("\\supset" . ?âŠƒ)
    ("\\supseteq" . ?âŠ‡)
    ("\\supseteqq" . ?â«†)
    ("\\supsetneq" . ?âŠ‹)
    ("\\supsetneqq" . ?â«Œ)
    ("\\surd" . ?âˆš)
    ("\\swarrow" . ?â†™)
    ("\\therefore" . ?âˆ´)
    ("\\thickapprox" . ?â‰ˆ)
    ("\\thicksim" . ?âˆ¼)
    ("\\to" . ?â†’)
    ("\\top" . ?âŠ¤)
    ("\\triangle" . ?â–³)
    ("\\triangledown" . ?â–¿)
    ("\\triangleleft" . ?â—ƒ)
    ("\\trianglelefteq" . ?âŠ´)
    ("\\triangleq" . ?â‰œ)
    ("\\triangleright" . ?â–¹)
    ("\\trianglerighteq" . ?âŠµ)
    ("\\twoheadleftarrow" . ?â†)
    ("\\twoheadrightarrow" . ?â† )
    ("\\ulcorner" . ?âŒœ)
    ("\\uparrow" . ?â†‘)
    ("\\updownarrow" . ?â†•)
    ("\\upleftharpoon" . ?â†¿)
    ("\\uplus" . ?âŠ)
    ("\\uprightharpoon" . ?â†¾)
    ("\\upuparrows" . ?â‡ˆ)
    ("\\urcorner" . ?âŒ)
    ("\\u{i}" . ?Ä­)
    ("\\vDash" . ?âŠ¨)
    ("\\varepsilon" . ?ğœ€)
    ("\\varphi" . ?ğœ‘)
    ("\\varprime" . ?â€²)
    ("\\varpropto" . ?âˆ)
    ("\\varrho" . ?ğœš)
    ("\\varsigma" . ?ğœ)
    ("\\vartriangleleft" . ?âŠ²)
    ("\\vartriangleright" . ?âŠ³)
    ("\\vdash" . ?âŠ¢)
    ("\\vdots" . ?â‹®)
    ("\\vee" . ?âˆ¨)
    ("\\veebar" . ?âŠ»)
    ("\\vert" . ?|)
    ("\\wedge" . ?âˆ§)
    ("\\wp" . ?â„˜)
    ("\\wr" . ?â‰€)
    ("\\Bbb{N}" . ?â„•)			; AMS commands for blackboard bold
    ("\\Bbb{P}" . ?â„™)			; Also sometimes \mathbb.
    ("\\Bbb{Q}" . ?â„š)
    ("\\Bbb{R}" . ?â„)
    ("\\Bbb{Z}" . ?â„¤)
    ("--" . ?â€“)
    ("---" . ?â€”)
    ("\\ordfeminine" . ?Âª)
    ("\\ordmasculine" . ?Âº)
    ("\\lambdabar" . ?Æ›)
    ("\\celsius" . ?â„ƒ)
    ("\\textmu" . ?Âµ)
    ("\\textfractionsolidus" . ?â„)
    ("\\textbigcircle" . ?âƒ)
    ("\\textmusicalnote" . ?â™ª)
    ("\\textdied" . ?âœ)
    ("\\textcolonmonetary" . ?â‚¡)
    ("\\textwon" . ?â‚©)
    ("\\textnaira" . ?â‚¦)
    ("\\textpeso" . ?â‚±)
    ("\\textlira" . ?â‚¤)
    ("\\textrecipe" . ?â„)
    ("\\textinterrobang" . ?â€½)
    ("\\textpertenthousand" . ?â€±)
    ("\\textbaht" . ?à¸¿)
    ("\\textnumero" . ?â„–)
    ("\\textdiscount" . ?â’)
    ("\\textestimated" . ?â„®)
    ("\\textopenbullet" . ?â—¦)
    ("\\textlquill" . 8261)		; Literal ?â… breaks indentation.
    ("\\textrquill" . 8262)             ; Literal ?â† breaks indentation.
    ("\\textcircledP" . ?â„—)
    ("\\textreferencemark" . ?â€»))
  "A `prettify-symbols-alist' usable for (La)TeX modes.")



(setq-local prettify-symbols-alist md-math-prettify-symbols-alist)

(add-function :override (local 'prettify-symbols-compose-predicate)
              #'md-math-prettify-symbols-compose-p)

(defun md-math-prettify-symbols-compose-p (_start end _match)
  (or
   ;; If the matched symbol doesn't end in a word character, then we
   ;; simply allow composition.  The symbol is probably something like
   ;; \|, \(, etc.
   (not (eq ?w (char-syntax (char-before end))))
   ;; Else we look at what follows the match in order to decide.
   (let* ((after-char (char-after end))
          (after-syntax (char-syntax after-char)))
     (not (or
           ;; Don't compose \alpha@foo.
           (eq after-char ?@)
           ;; The \alpha in \alpha2 or \alpha-\beta may be composed but
           ;; of course \alphax may not.
           (and (eq after-syntax ?w)
                (not (memq after-char
                           '(?0 ?1 ?2 ?3 ?4 ?5 ?6 ?7 ?8 ?9 ?+ ?- ?' ?\"))))
           ;; Don't compose inside verbatim blocks.
           (eq 2 (nth 7 (syntax-ppss))))))))


(provide 'md-math-symbols)
